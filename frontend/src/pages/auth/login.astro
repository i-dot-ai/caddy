---
// OAuth2 agnostic authentication redirect
const oidcIssuer = process.env.OIDC_ISSUER;
const clientId = process.env.OIDC_AUDIENCE;
const redirectUri = `${Astro.url.origin}/auth/callback`;

// Build OAuth2 authorization URL - works for both Keycloak and Dex
const authUrl = new URL(`${oidcIssuer}/auth`);
authUrl.searchParams.set('response_type', 'code');
authUrl.searchParams.set('client_id', clientId);
authUrl.searchParams.set('redirect_uri', redirectUri);
authUrl.searchParams.set('scope', 'openid email profile');
authUrl.searchParams.set('state', crypto.randomUUID());

return Astro.redirect(authUrl.toString());
---