---
import Layout from '@layouts/Layout.astro';
import { getResourceDetails, getSingleResource } from '@logic/data.ts';

const { collection: collectionId, resource: resourceId } = Astro.params;
const token = await Astro.session.get('accessToken');
const resource = await getResourceDetails(collectionId || '', resourceId || '', token);
const document = await getSingleResource(collectionId || '', resourceId || '', token);
---

<Layout title={resource.filename || resource.id}>
  <nav class="govuk-breadcrumbs govuk-!-margin-bottom-6" aria-label="Breadcrumb">
    <ol class="govuk-breadcrumbs__list">
      <li class="govuk-breadcrumbs__list-item">
        <a class="govuk-breadcrumbs__link" href="/">Collections</a>
      </li>
      <li class="govuk-breadcrumbs__list-item">
        <a class="govuk-breadcrumbs__link" href="../resources">Resources</a>
      </li>
      <li class="govuk-breadcrumbs__list-item">
        Resource details
      </li>
    </ol>
  </nav>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-l">Resource details</h1>
      <p><strong>Resource:</strong> {resource.filename || resource.id}</p>

      <div class="milkdown-container">
        <div id="milkdown-editor">
          <div id="editor"></div>
        </div>
        <div class="editor-actions">
          <button id="save-btn" class="govuk-button">Save Changes</button>
          <button id="cancel-btn" class="govuk-button govuk-button--secondary govuk-!-margin-left-2">Cancel</button>
        </div>
      </div>

      <div id="markdown-content" style="display: none;">{document.page_content}</div>

      <style>
        /* Minimal container styling - let Crepe handle editor styles */
        .milkdown-container {
          margin-top: 2rem;
          border: 1px solid #e1e5e9;
          border-radius: 6px;
          background: white;
          overflow: hidden;
        }

        .editor-actions {
          padding: 12px;
          border-top: 1px solid #e1e5e9;
          background-color: #f8f9fa;
        }

        /* Use existing govuk button styles */
        .editor-actions .govuk-button--success {
          background-color: #00703c !important;
          border-color: #00703c !important;
        }
        
        .editor-actions .govuk-button--warning {
          background-color: #d4351c !important;
          border-color: #d4351c !important;
        }
        
        .editor-actions .govuk-button:disabled {
          opacity: 0.6;
          cursor: not-allowed;
        }

        /* Minimal editor container */
        #milkdown-editor {
          min-height: 300px;
        }
      </style>
      
      <!-- Remove external CSS - we'll apply styles inline to prevent conflicts -->

      <script type="module" src="../../../../../../src/components/milkdown-editor.ts"></script>
    </div>
  </div>
</Layout>